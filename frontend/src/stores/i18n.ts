import { defineStore } from 'pinia'
import { ref, computed } from 'vue'

export type Language = 'en' | 'cs'

interface Translations {
  [key: string]: string | Translations
}

const translations: Record<Language, Translations> = {
  en: {
    common: {
      dashboard: 'Dashboard',
      logout: 'Logout',
      loading: 'Loading...',
      save: 'Save',
      cancel: 'Cancel',
      delete: 'Delete',
      edit: 'Edit',
      add: 'Add',
      close: 'Close',
      search: 'Search',
      filter: 'Filter',
      actions: 'Actions',
      name: 'Name',
      email: 'Email',
      role: 'Role',
      yes: 'Yes',
      no: 'No'
    },
    dashboard: {
      title: 'Dashboard',
      currentlyRunningLessons: 'Currently Running Lessons',
      noLessonsRunning: 'No lessons are currently running',
      todaysAbsentTeachers: "Today's Absent Teachers",
      noTeachersAbsent: 'No teachers are absent today',
      class: 'Class',
      subject: 'Subject',
      teacher: 'Teacher',
      classroom: 'Classroom',
      timeRange: 'Time Range',
      reason: 'Reason'
    },
    navigation: {
      schoolSettings: 'School Settings',
      classes: 'Classes',
      teachers: 'Teachers',
      timetables: 'Timetables',
      teacherDashboard: 'Teacher Dashboard',
      reportAbsence: 'Report Absence',
      viewTimetable: 'View Timetable',
      scholarDashboard: 'Scholar Dashboard'
    },
    schoolSettings: {
      title: 'School Settings',
      back: 'Dashboard',
      configureSettings: 'Configure School Settings',
      configureDescription: 'Manage your school\'s timetable configuration including class hours, breaks, and lunch periods.',
      timeSettings: 'Time Settings',
      classHourSettings: 'Class Hour Settings',
      breakSettings: 'Break Settings',
      lunchSettings: 'Lunch Settings',
      startTime: 'Start Time',
      endTime: 'End Time',
      classHourLength: 'Class Hour Length (minutes)',
      breakDuration: 'Break Duration (minutes)',
      breakDurations: 'Break Durations (minutes)',
      defaultBreakDuration: 'Default Break Duration (minutes)',
      lunchDuration: 'Lunch Duration (minutes)',
      possibleLunchHours: 'Possible Lunch Hours',
      saveSettings: 'Save Settings',
      saving: 'Saving...',
      settingsSaved: 'Settings saved successfully',
      settingsError: 'Failed to save settings',
      schoolDayStart: 'School day start time',
      schoolDayEnd: 'School day end time',
      durationOfPeriod: 'Duration of each class period',
      breakAfterLesson: 'after lesson',
      addBreak: 'Add Break',
      removeBreak: 'Remove break',
      setBreakDurations: 'Set the duration for each break between lessons. The last break duration will be used for any additional breaks if needed.',
      fallbackDuration: 'Fallback duration if break_durations is not set',
      commaSeparatedHours: 'Comma-separated lesson indices when lunch is possible (e.g., 3,4,5). Lesson indices start from 1.'
    },
    classes: {
      title: 'Classes',
      back: 'Dashboard',
      selectClass: 'Select Class',
      selectAClass: 'Select a class...',
      timetable: 'Timetable',
      loadingTimetable: 'Loading timetable...',
      noTimetableAvailable: 'No timetable available for this class',
      subjects: 'Subjects',
      noSubjectsAllocated: 'No subjects allocated to this class',
      manageClass: 'Manage Class',
      manageSubjects: 'Manage Subjects',
      manageSubjectAllocations: 'Manage Subject Allocations for',
      addSubjectAllocation: 'Add Subject Allocation',
      selectSubject: 'Select Subject',
      weeklyHours: 'Weekly Hours',
      yearlyHours: 'Yearly Hours',
      hoursPerWeek: 'hours/week',
      teachers: 'Teachers',
      noTeachersAssigned: 'No teachers assigned',
      existingAllocations: 'Existing Allocations',
      noAllocations: 'No allocations found',
      updateAllocation: 'Update',
      removeAllocation: 'Remove',
      addClass: 'Add Class',
      editClass: 'Edit Class',
      deleteClass: 'Delete Class',
      className: 'Class Name',
      gradeLevel: 'Grade Level',
      noClasses: 'No classes found'
    },
    teachers: {
      title: 'Teachers',
      back: 'Dashboard',
      addNewTeacher: 'Add New Teacher',
      fullName: 'Full Name',
      maxWeeklyHours: 'Max Weekly Hours',
      availability: 'Availability',
      availabilityFormat: 'Format: day:hour1,hour2 (e.g., monday:1,2,3 tuesday:1,2)',
      availabilityPlaceholder: 'Availability (e.g., monday:1,2,3 tuesday:1,2)',
      addTeacher: 'Add Teacher',
      filterByTeacher: 'Filter by Teacher',
      allTeachers: 'All Teachers',
      absencesFor: 'Absences for',
      loadingAbsences: 'Loading absences...',
      noAbsencesReported: 'No absences reported',
      reason: 'Reason',
      teachersList: 'Teachers List',
      maxHours: 'Max Hours',
      subjectCapabilities: 'Subject Capabilities',
      addCapability: 'Add Capability',
      selectSubject: 'Select Subject',
      selectGradeLevel: 'Select Grade Level (optional)',
      selectClassGroup: 'Select Class Group (optional)',
      isPrimary: 'Is Primary Teacher',
      editTeacher: 'Edit Teacher',
      deleteTeacher: 'Delete Teacher',
      save: 'Save',
      cancel: 'Cancel',
      noTeachers: 'No teachers found',
      seeAbsences: 'See Absences',
      capabilities: 'Capabilities',
      absences: 'Absences'
    },
    timetables: {
      title: 'Timetables',
      back: 'Dashboard',
      generateTimetable: 'Generate Timetable',
      timetableName: 'Timetable Name',
      validFrom: 'Valid From',
      validTo: 'Valid To',
      generate: 'Generate',
      generating: 'Generating...',
      validating: 'Validating...',
      deleteTimetable: 'Delete Timetable',
      noTimetables: 'No timetables found',
      viewTimetable: 'View Timetable',
      calendar: 'Calendar',
      monthView: 'Month View',
      dayView: 'Day View',
      timetablesList: 'Timetables List',
      selectClass: 'Select Class',
      allClasses: 'All Classes',
      primary: 'Primary',
      substitute: 'Substitute',
      substituteForDate: 'Substitute for Date',
      isPrimary: 'Is Primary',
      entries: 'Entries',
      actions: 'Actions',
      selectTimetable: 'Select Timetable',
      noTimetableSelected: 'No timetable selected',
      loadingTimetable: 'Loading timetable...',
      monday: 'Monday',
      tuesday: 'Tuesday',
      wednesday: 'Wednesday',
      thursday: 'Thursday',
      friday: 'Friday',
      lunchBreak: 'Lunch Break'
    },
    subjects: {
      title: 'Subjects',
      back: 'Dashboard',
      addNewSubject: 'Add New Subject',
      subjectName: 'Subject Name',
      canBeMultipleTimesPerDay: 'Can be multiple times per day',
      mustBeConsecutive: 'Must be consecutive hours',
      consecutiveHours: 'Consecutive Hours',
      addSubject: 'Add Subject',
      subjectsList: 'Subjects List',
      editSubject: 'Edit Subject',
      deleteSubject: 'Delete Subject',
      save: 'Save',
      cancel: 'Cancel',
      noSubjects: 'No subjects found'
    },
    classrooms: {
      title: 'Classrooms',
      back: 'Dashboard',
      addNewClassroom: 'Add New Classroom',
      classroomName: 'Classroom Name',
      specializations: 'Specializations',
      selectSpecializations: 'Select Specializations (multiple)',
      noSpecialization: 'No specialization',
      addClassroom: 'Add Classroom',
      classroomsList: 'Classrooms List',
      editClassroom: 'Edit Classroom',
      deleteClassroom: 'Delete Classroom',
      save: 'Save',
      cancel: 'Cancel',
      noClassrooms: 'No classrooms found'
    },
    login: {
      title: 'Login',
      email: 'Email',
      password: 'Password',
      loginButton: 'Login',
      loginError: 'Login failed. Please check your credentials.'
    },
    errors: {
      required: 'This field is required',
      invalidEmail: 'Invalid email address',
      networkError: 'Network error. Please try again.',
      unauthorized: 'Unauthorized access',
      notFound: 'Resource not found',
      serverError: 'Server error. Please try again later.'
    },
    commonPhrases: {
      back: 'Back',
      unknown: 'Unknown',
      na: 'N/A',
      all: 'All',
      none: 'None',
      select: 'Select',
      optional: 'Optional',
      required: 'Required',
      confirm: 'Confirm',
      areYouSure: 'Are you sure?',
      thisActionCannotBeUndone: 'This action cannot be undone.'
    }
  },
  cs: {
    common: {
      dashboard: 'Nástěnka',
      logout: 'Odhlásit',
      loading: 'Načítání...',
      save: 'Uložit',
      cancel: 'Zrušit',
      delete: 'Smazat',
      edit: 'Upravit',
      add: 'Přidat',
      close: 'Zavřít',
      search: 'Hledat',
      filter: 'Filtr',
      actions: 'Akce',
      name: 'Název',
      email: 'Email',
      role: 'Role',
      yes: 'Ano',
      no: 'Ne'
    },
    dashboard: {
      title: 'Nástěnka',
      currentlyRunningLessons: 'Právě probíhající hodiny',
      noLessonsRunning: 'Momentálně neprobíhají žádné hodiny',
      todaysAbsentTeachers: 'Dnes nepřítomní učitelé',
      noTeachersAbsent: 'Dnes nejsou žádní nepřítomní učitelé',
      class: 'Třída',
      subject: 'Předmět',
      teacher: 'Učitel',
      classroom: 'Učebna',
      timeRange: 'Časový rozsah',
      reason: 'Důvod'
    },
    navigation: {
      schoolSettings: 'Nastavení školy',
      classes: 'Třídy',
      teachers: 'Učitelé',
      timetables: 'Rozvrhy',
      teacherDashboard: 'Nástěnka učitele',
      reportAbsence: 'Nahlásit nepřítomnost',
      viewTimetable: 'Zobrazit rozvrh',
      scholarDashboard: 'Nástěnka žáka'
    },
    schoolSettings: {
      title: 'Nastavení školy',
      back: 'Nástěnka',
      configureSettings: 'Konfigurovat nastavení školy',
      configureDescription: 'Spravujte konfiguraci rozvrhu školy včetně vyučovacích hodin, přestávek a obědů.',
      timeSettings: 'Nastavení času',
      classHourSettings: 'Nastavení vyučovacích hodin',
      breakSettings: 'Nastavení přestávek',
      lunchSettings: 'Nastavení oběda',
      startTime: 'Začátek',
      endTime: 'Konec',
      classHourLength: 'Délka vyučovací hodiny (minuty)',
      breakDuration: 'Délka přestávky (minuty)',
      breakDurations: 'Délky přestávek (minuty)',
      defaultBreakDuration: 'Výchozí délka přestávky (minuty)',
      lunchDuration: 'Délka oběda (minuty)',
      possibleLunchHours: 'Možné hodiny oběda',
      saveSettings: 'Uložit nastavení',
      saving: 'Ukládání...',
      settingsSaved: 'Nastavení bylo úspěšně uloženo',
      settingsError: 'Nepodařilo se uložit nastavení',
      schoolDayStart: 'Začátek školního dne',
      schoolDayEnd: 'Konec školního dne',
      durationOfPeriod: 'Délka každé vyučovací hodiny',
      breakAfterLesson: 'po hodině',
      addBreak: 'Přidat přestávku',
      removeBreak: 'Odstranit přestávku',
      setBreakDurations: 'Nastavte délku každé přestávky mezi hodinami. Poslední délka přestávky bude použita pro případné další přestávky.',
      fallbackDuration: 'Záložní délka, pokud není nastaveno break_durations',
      commaSeparatedHours: 'Čárkami oddělené indexy hodin, kdy je možný oběd (např. 3,4,5). Indexy hodin začínají od 1.'
    },
    classes: {
      title: 'Třídy',
      back: 'Nástěnka',
      selectClass: 'Vybrat třídu',
      selectAClass: 'Vyberte třídu...',
      timetable: 'Rozvrh',
      loadingTimetable: 'Načítání rozvrhu...',
      noTimetableAvailable: 'Pro tuto třídu není k dispozici žádný rozvrh',
      subjects: 'Předměty',
      noSubjectsAllocated: 'Této třídě nejsou přiděleny žádné předměty',
      manageClass: 'Spravovat třídu',
      manageSubjects: 'Spravovat předměty',
      manageSubjectAllocations: 'Spravovat přidělení předmětů pro',
      addSubjectAllocation: 'Přidat přidělení předmětu',
      selectSubject: 'Vybrat předmět',
      weeklyHours: 'Týdenní hodiny',
      yearlyHours: 'Roční hodiny',
      hoursPerWeek: 'hodin/týden',
      teachers: 'Učitelé',
      noTeachersAssigned: 'Nejsou přiřazeni žádní učitelé',
      existingAllocations: 'Existující přidělení',
      noAllocations: 'Nebyla nalezena žádná přidělení',
      updateAllocation: 'Aktualizovat',
      removeAllocation: 'Odstranit',
      addClass: 'Přidat třídu',
      editClass: 'Upravit třídu',
      deleteClass: 'Smazat třídu',
      className: 'Název třídy',
      gradeLevel: 'Ročník',
      noClasses: 'Nebyly nalezeny žádné třídy'
    },
    teachers: {
      title: 'Učitelé',
      back: 'Nástěnka',
      addNewTeacher: 'Přidat nového učitele',
      fullName: 'Celé jméno',
      maxWeeklyHours: 'Maximální týdenní hodiny',
      availability: 'Dostupnost',
      availabilityFormat: 'Formát: den:hodina1,hodina2 (např. pondělí:1,2,3 úterý:1,2)',
      availabilityPlaceholder: 'Dostupnost (např. pondělí:1,2,3 úterý:1,2)',
      addTeacher: 'Přidat učitele',
      filterByTeacher: 'Filtrovat podle učitele',
      allTeachers: 'Všichni učitelé',
      absencesFor: 'Nepřítomnosti pro',
      loadingAbsences: 'Načítání nepřítomností...',
      noAbsencesReported: 'Nejsou hlášeny žádné nepřítomnosti',
      reason: 'Důvod',
      teachersList: 'Seznam učitelů',
      maxHours: 'Max. hodiny',
      subjectCapabilities: 'Schopnosti v předmětech',
      addCapability: 'Přidat schopnost',
      selectSubject: 'Vybrat předmět',
      selectGradeLevel: 'Vybrat ročník (volitelné)',
      selectClassGroup: 'Vybrat třídu (volitelné)',
      isPrimary: 'Je hlavní učitel',
      editTeacher: 'Upravit učitele',
      deleteTeacher: 'Smazat učitele',
      save: 'Uložit',
      cancel: 'Zrušit',
      noTeachers: 'Nebyli nalezeni žádní učitelé',
      seeAbsences: 'Zobrazit nepřítomnosti',
      capabilities: 'Schopnosti',
      absences: 'Nepřítomnosti'
    },
    timetables: {
      title: 'Rozvrhy',
      back: 'Nástěnka',
      generateTimetable: 'Vygenerovat rozvrh',
      timetableName: 'Název rozvrhu',
      validFrom: 'Platný od',
      validTo: 'Platný do',
      generate: 'Vygenerovat',
      generating: 'Generování...',
      validating: 'Ověřování...',
      deleteTimetable: 'Smazat rozvrh',
      noTimetables: 'Nebyly nalezeny žádné rozvrhy',
      viewTimetable: 'Zobrazit rozvrh',
      calendar: 'Kalendář',
      monthView: 'Měsíční zobrazení',
      dayView: 'Denní zobrazení',
      timetablesList: 'Seznam rozvrhů',
      selectClass: 'Vybrat třídu',
      allClasses: 'Všechny třídy',
      primary: 'Hlavní',
      substitute: 'Náhradní',
      substituteForDate: 'Náhradní pro datum',
      isPrimary: 'Je hlavní',
      entries: 'Záznamy',
      actions: 'Akce',
      selectTimetable: 'Vybrat rozvrh',
      noTimetableSelected: 'Není vybrán žádný rozvrh',
      loadingTimetable: 'Načítání rozvrhu...',
      monday: 'Pondělí',
      tuesday: 'Úterý',
      wednesday: 'Středa',
      thursday: 'Čtvrtek',
      friday: 'Pátek',
      lunchBreak: 'Oběd'
    },
    subjects: {
      title: 'Předměty',
      back: 'Nástěnka',
      addNewSubject: 'Přidat nový předmět',
      subjectName: 'Název předmětu',
      canBeMultipleTimesPerDay: 'Může být vícekrát denně',
      mustBeConsecutive: 'Musí být po sobě jdoucí hodiny',
      consecutiveHours: 'Po sobě jdoucí hodiny',
      addSubject: 'Přidat předmět',
      subjectsList: 'Seznam předmětů',
      editSubject: 'Upravit předmět',
      deleteSubject: 'Smazat předmět',
      save: 'Uložit',
      cancel: 'Zrušit',
      noSubjects: 'Nebyly nalezeny žádné předměty'
    },
    classrooms: {
      title: 'Učebny',
      back: 'Nástěnka',
      addNewClassroom: 'Přidat novou učebnu',
      classroomName: 'Název učebny',
      specializations: 'Specializace',
      selectSpecializations: 'Vybrat specializace (více)',
      noSpecialization: 'Bez specializace',
      addClassroom: 'Přidat učebnu',
      classroomsList: 'Seznam učeben',
      editClassroom: 'Upravit učebnu',
      deleteClassroom: 'Smazat učebnu',
      save: 'Uložit',
      cancel: 'Zrušit',
      noClassrooms: 'Nebyly nalezeny žádné učebny'
    },
    login: {
      title: 'Přihlášení',
      email: 'Email',
      password: 'Heslo',
      loginButton: 'Přihlásit',
      loginError: 'Přihlášení selhalo. Zkontrolujte prosím své přihlašovací údaje.'
    },
    errors: {
      required: 'Toto pole je povinné',
      invalidEmail: 'Neplatná emailová adresa',
      networkError: 'Chyba sítě. Zkuste to prosím znovu.',
      unauthorized: 'Neautorizovaný přístup',
      notFound: 'Zdroj nenalezen',
      serverError: 'Chyba serveru. Zkuste to prosím později.'
    },
    commonPhrases: {
      back: 'Zpět',
      unknown: 'Neznámý',
      na: 'N/A',
      all: 'Vše',
      none: 'Žádné',
      select: 'Vybrat',
      optional: 'Volitelné',
      required: 'Povinné',
      confirm: 'Potvrdit',
      areYouSure: 'Jste si jisti?',
      thisActionCannotBeUndone: 'Tuto akci nelze vrátit zpět.'
    }
  }
}

export const useI18nStore = defineStore('i18n', () => {
  const currentLanguage = ref<Language>(
    (localStorage.getItem('language') as Language) || 'en'
  )

  const t = computed(() => {
    return (key: string): string => {
      const keys = key.split('.')
      let value: any = translations[currentLanguage.value]
      
      for (const k of keys) {
        if (value && typeof value === 'object' && k in value) {
          value = value[k]
        } else {
          return key // Return key if translation not found
        }
      }
      
      return typeof value === 'string' ? value : key
    }
  })

  function setLanguage(lang: Language) {
    currentLanguage.value = lang
    localStorage.setItem('language', lang)
  }

  function getCurrentLanguage(): Language {
    return currentLanguage.value
  }

  return {
    currentLanguage,
    t,
    setLanguage,
    getCurrentLanguage
  }
})

